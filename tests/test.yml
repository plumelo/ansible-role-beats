---

- hosts: all
  become: true
  roles:
    - role: plumelo.beats
      filebeat_configs:
        filebeat.inputs:
          - type: log
            enabled: false
            paths:
              - /var/log/*.log
        filebeat.config.modules:
          path: /etc/filebeat/modules.d/*.yml
          reload.enabled: false
          reload.period: 10s
        output.elasticsearch:
          hosts: ["localhost:9200"]
          protocol: "http"
          username: "elastic"
          password: "changeme"
        filebeat.modules:
          - module: nginx
          - module: mysql
          - module: system
            syslog:
              enabled: true
          - module: auditd
            log:
              enabled: true
          - module: icinga
            main:
              enabled: true
            startup:
              enabled: true
          - module: mysql
            error:
              enabled: true
            slowlog:
              enabled: true
          - module: nginx
            access:
              enabled: true
            error:
              enabled: true
          - module: redis
            log:
              enabled: true
              var.paths: ["/var/log/redis/redis-server.log*"]
            slowlog:
              enabled: true
              var.hosts: ["localhost:6379"]
